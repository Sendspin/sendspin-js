<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sendspin Sample Player</title>
    <link rel="stylesheet" href="public/styles.css" />
  </head>
  <body>
    <div class="container">
      <header>
        <h1>Sendspin Sample Player</h1>
        <p class="subtitle">
          A sample web player using the
          <a href="https://github.com/sendspin/sendspin-js" target="_blank"
            >sendspin-js</a
          >
          SDK
        </p>
      </header>

      <main>
        <!-- Connection Section -->
        <section class="card" id="connection-section">
          <h2>Server Connection</h2>
          <div class="form-group">
            <label for="server-url">Server URL</label>
            <input
              type="text"
              id="server-url"
              placeholder="homeassistant.local:8927"
              spellcheck="false"
              value=""
            />
            <small id="server-url-hint">Enter the Sendspin server URL</small>
          </div>
          <div class="button-group">
            <button id="connect-btn" class="btn btn-primary">Connect</button>
            <button id="copy-url-btn" class="btn btn-secondary">
              Copy Share URL
            </button>
          </div>
        </section>

        <!-- Now Playing Section -->
        <section class="card" id="now-playing-section">
          <h2>Now Playing</h2>
          <div class="now-playing">
            <div class="album-art">
              <img id="artwork" src="" alt="" style="display: none" />
              <div id="artwork-placeholder">üéµ</div>
            </div>
            <div class="track-info">
              <div id="track-title" class="track-title">-</div>
              <div id="track-artist" class="track-artist">-</div>
              <div id="track-album" class="track-album">-</div>
              <div id="group-name" class="group-name"></div>
            </div>
          </div>
        </section>

        <!-- Server Controls -->
        <section class="card" id="server-controls-section">
          <h2>Server Controls</h2>
          <div class="form-group">
            <label>Transport</label>
            <div class="transport-controls">
              <button id="prev-btn" class="btn btn-icon" title="Previous">
                ‚èÆ
              </button>
              <button id="play-btn" class="btn btn-icon btn-large" title="Play">
                ‚ñ∂
              </button>
              <button
                id="pause-btn"
                class="btn btn-icon btn-large"
                title="Pause"
              >
                ‚è∏
              </button>
              <button id="stop-btn" class="btn btn-icon" title="Stop">‚èπ</button>
              <button id="next-btn" class="btn btn-icon" title="Next">
                ‚è≠
              </button>
            </div>
            <div class="playback-options">
              <button
                id="shuffle-btn"
                class="btn btn-secondary"
                title="Shuffle"
              >
                üîÄ Shuffle
              </button>
              <button
                id="unshuffle-btn"
                class="btn btn-secondary"
                title="Unshuffle"
              >
                üîÄ Unshuffle
              </button>
              <button
                id="repeat-off-btn"
                class="btn btn-secondary"
                title="Repeat Off"
              >
                üîÅ Repeat Off
              </button>
              <button
                id="repeat-one-btn"
                class="btn btn-secondary"
                title="Repeat One"
              >
                üîÇ Repeat One
              </button>
              <button
                id="repeat-all-btn"
                class="btn btn-secondary"
                title="Repeat All"
              >
                üîÅ Repeat All
              </button>
              <button
                id="switch-group-btn"
                class="btn btn-secondary"
                title="Switch Group"
              >
                üìª Switch Group
              </button>
            </div>
            <small
              >Send commands to the server (controls the audio source)</small
            >
          </div>
        </section>

        <!-- Local Playback Controls -->
        <section class="card" id="controls-section">
          <h2>Local Controls</h2>
          <div class="volume-control">
            <label for="volume-slider">Volume</label>
            <div class="volume-row">
              <button id="mute-btn" class="btn btn-icon" title="Toggle Mute">
                <span id="mute-icon">üîä</span>
              </button>
              <input
                type="range"
                id="volume-slider"
                min="0"
                max="100"
                value="80"
              />
              <span id="volume-value">80%</span>
            </div>
          </div>
          <div class="form-group">
            <label for="sync-delay">Sync Delay (ms)</label>
            <div class="sync-delay-row">
              <input
                type="number"
                id="sync-delay"
                value="0"
                min="-1000"
                max="1000"
                step="10"
              />
              <button id="apply-sync-delay" class="btn btn-secondary">
                Apply
              </button>
            </div>
            <small
              >Adjust audio sync delay to compensate for device latency</small
            >
          </div>
        </section>

        <!-- Status Section -->
        <section class="card" id="status-section">
          <h2>Player Status</h2>
          <div class="status-grid">
            <div class="status-item">
              <span class="status-label">Connection</span>
              <span id="connection-status" class="status-value disconnected"
                >Disconnected</span
              >
            </div>
            <div class="status-item">
              <span class="status-label">Playback</span>
              <span id="playback-status" class="status-value">Stopped</span>
            </div>
            <div class="status-item">
              <span class="status-label">Sync State</span>
              <span id="sync-status" class="status-value">-</span>
            </div>
            <div class="status-item">
              <span class="status-label">Format</span>
              <span id="format-status" class="status-value">-</span>
            </div>
          </div>

          <h3>Sync Information</h3>
          <div class="status-grid">
            <div class="status-item">
              <span class="status-label">Clock Drift</span>
              <span id="clock-drift" class="status-value">-</span>
            </div>
            <div class="status-item">
              <span class="status-label">Sync Error</span>
              <span id="sync-error" class="status-value">-</span>
            </div>
            <div class="status-item">
              <span class="status-label">Output Latency</span>
              <span id="output-latency" class="status-value">-</span>
            </div>
            <div class="status-item">
              <span class="status-label">Resync Count</span>
              <span id="resync-count" class="status-value">-</span>
            </div>
          </div>
        </section>

        <!-- Code Example -->
        <section class="card">
          <h2>Code Example</h2>
          <p>
            This player is built with vanilla JavaScript using the sendspin-js
            SDK:
          </p>
          <pre><code>import { SendspinPlayer } from '@music-assistant/sendspin-js';

const player = new SendspinPlayer({
  playerId: 'my-player-id',
  baseUrl: 'http://your-server:8095',
  clientName: 'My Web Player',
  audioOutputMode: 'direct',
  onStateChange: (state) => {
    // Local player state
    console.log('Playing:', state.isPlaying);
    console.log('Volume:', state.volume, 'Muted:', state.muted);

    // Server state (metadata, controller info)
    if (state.serverState?.metadata) {
      const meta = state.serverState.metadata;
      console.log('Track:', meta.title, '-', meta.artist);
    }

    // Group state (playback state, group info)
    if (state.groupState) {
      console.log('Group:', state.groupState.group_name);
      console.log('Playback:', state.groupState.playback_state);
    }
  }
});

// Connect to server
await player.connect();

// Local volume control (affects this player only)
player.setVolume(80);
player.setMuted(false);

// Send commands to server (controls the source)
player.sendCommand('play');
player.sendCommand('pause');
player.sendCommand('stop');
player.sendCommand('next');
player.sendCommand('previous');
player.sendCommand('volume', { volume: 50 });
player.sendCommand('mute', { mute: true });
player.sendCommand('shuffle');
player.sendCommand('unshuffle');
player.sendCommand('repeat_off');
player.sendCommand('repeat_one');
player.sendCommand('repeat_all');
player.sendCommand('switch');  // Switch group

// Disconnect with reason (optional)
player.disconnect('user_request');</code></pre>
        </section>
      </main>

      <footer>
        <p>
          <a
            href="https://github.com/music-assistant/sendspin-js"
            target="_blank"
            >GitHub</a
          >
          |
          <a
            href="https://www.npmjs.com/package/@music-assistant/sendspin-js"
            target="_blank"
            >npm</a
          >
          | Part of the
          <a href="https://github.com/Sendspin/spec" target="_blank"
            >Sendspin Protocol</a
          >
        </p>
      </footer>
    </div>

    <!-- Hidden audio element for media-element mode (mobile support) -->
    <audio id="audio-element" style="display: none"></audio>

    <script type="module" src="public/app.js"></script>
  </body>
</html>
