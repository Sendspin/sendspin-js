<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sendspin Sample Player</title>
    <link rel="stylesheet" href="public/styles.css" />
  </head>
  <body>
    <div class="container">
      <header>
        <h1>Sendspin Sample Player</h1>
        <p class="subtitle">
          A sample web player using the
          <a href="https://github.com/sendspin/sendspin-js" target="_blank"
            >sendspin-js</a
          >
          SDK
        </p>
      </header>

      <main>
        <!-- Connection Section (disconnected state) -->
        <section class="card" id="connection-section">
          <h2>Server Connection</h2>
          <div class="https-warning" id="https-warning" style="display: none">
            <strong>HTTPS Required</strong>
            <p>
              This demo player is hosted on HTTPS. Browser security prevents
              connecting to HTTP servers (like local Sendspin servers). You need
              a Sendspin server with HTTPS enabled.
            </p>
          </div>
          <div class="form-group">
            <label for="server-url">Server URL</label>
            <input
              type="text"
              id="server-url"
              placeholder="homeassistant.local:8927"
              spellcheck="false"
              value=""
            />
            <small id="server-url-hint">Enter the Sendspin server URL</small>
          </div>
          <div class="button-group">
            <button id="connect-btn" class="btn btn-primary">Connect</button>
          </div>
        </section>

        <!-- Connected Status Bar -->
        <section class="card" id="connected-bar">
          <div class="connected-bar-content">
            <div class="connected-info">
              <span class="connected-indicator"></span>
              <span
                id="connected-server-url"
                class="connected-server-url"
              ></span>
            </div>
            <div class="connected-actions">
              <button id="copy-url-btn" class="btn btn-secondary">Share</button>
              <button id="disconnect-btn" class="btn btn-primary connected">
                Disconnect
              </button>
            </div>
          </div>
        </section>

        <!-- Now Playing Section -->
        <section class="card" id="now-playing-section">
          <h2>Now Playing</h2>
          <div class="now-playing">
            <div class="album-art">
              <img id="artwork" src="" alt="" style="display: none" />
              <div id="artwork-placeholder">üéµ</div>
            </div>
            <div class="track-info">
              <div id="track-title" class="track-title">-</div>
              <div id="track-artist" class="track-artist">-</div>
              <div id="track-album" class="track-album">-</div>
              <div id="group-name" class="group-name"></div>
            </div>
          </div>
        </section>

        <!-- Server Controls -->
        <section class="card" id="server-controls-section">
          <h2>Server Controls</h2>
          <div class="form-group">
            <div class="transport-controls">
              <button
                class="btn btn-icon transport-btn"
                data-command="previous"
                title="Previous"
              >
                ‚èÆ
              </button>
              <button
                class="btn btn-icon btn-large transport-btn"
                data-command="play"
                title="Play"
              >
                ‚ñ∂
              </button>
              <button
                class="btn btn-icon btn-large transport-btn"
                data-command="pause"
                title="Pause"
              >
                ‚è∏
              </button>
              <button
                class="btn btn-icon transport-btn"
                data-command="stop"
                title="Stop"
              >
                ‚èπ
              </button>
              <button
                class="btn btn-icon transport-btn"
                data-command="next"
                title="Next"
              >
                ‚è≠
              </button>
            </div>
            <div class="playback-options">
              <button
                class="btn btn-secondary transport-btn"
                data-command="shuffle"
                title="Shuffle"
              >
                üîÄ Shuffle
              </button>
              <button
                class="btn btn-secondary transport-btn"
                data-command="unshuffle"
                title="Unshuffle"
              >
                üîÄ Unshuffle
              </button>
              <button
                class="btn btn-secondary transport-btn"
                data-command="repeat_off"
                title="Repeat Off"
              >
                üîÅ Repeat Off
              </button>
              <button
                class="btn btn-secondary transport-btn"
                data-command="repeat_one"
                title="Repeat One"
              >
                üîÇ Repeat One
              </button>
              <button
                class="btn btn-secondary transport-btn"
                data-command="repeat_all"
                title="Repeat All"
              >
                üîÅ Repeat All
              </button>
              <button
                class="btn btn-secondary transport-btn"
                data-command="switch"
                title="Switch Group"
              >
                üìª Switch Group
              </button>
            </div>
            <small
              >Send commands to the server (controls the audio source)</small
            >
          </div>
          <div class="volume-control">
            <label>Group Volume</label>
            <div class="volume-row">
              <button
                id="group-mute-btn"
                class="btn btn-icon"
                title="Toggle Group Mute"
              >
                <span id="group-mute-icon">üîä</span>
              </button>
              <input
                type="range"
                id="group-volume-slider"
                min="0"
                max="100"
                value="80"
              />
              <span id="group-volume-value">-</span>
            </div>
          </div>
        </section>

        <!-- Local Playback Controls -->
        <section class="card" id="controls-section">
          <h2>Local Controls</h2>
          <div class="volume-control">
            <label for="volume-slider">Volume</label>
            <div class="volume-row">
              <button id="mute-btn" class="btn btn-icon" title="Toggle Mute">
                <span id="mute-icon">üîä</span>
              </button>
              <input
                type="range"
                id="volume-slider"
                min="0"
                max="100"
                value="80"
              />
              <span id="volume-value">80%</span>
            </div>
          </div>
          <div class="form-group">
            <label for="sync-delay">Sync Delay (ms)</label>
            <div class="sync-delay-row">
              <input
                type="number"
                id="sync-delay"
                value="0"
                min="-1000"
                max="1000"
                step="10"
              />
              <button id="apply-sync-delay" class="btn btn-secondary">
                Apply
              </button>
            </div>
            <small
              >Adjust audio sync delay to compensate for device latency</small
            >
          </div>
          <div class="form-group">
            <label for="correction-mode">Correction Mode</label>
            <select id="correction-mode">
              <option value="sync">Sync (default)</option>
              <option value="quality">Quality</option>
              <option value="quality-local">Quality (Local)</option>
            </select>
            <small>
              <strong>Sync</strong>: fastest group sync; may use playback-rate
              changes, so you might hear pitch shifts right after start.
              <br />
              <strong>Quality</strong>: no playback-rate changes; uses sample
              fixes and tighter resyncs, so expect fewer shifts but occasional
              jumps while clocks converge.
              <br />
              <strong>Quality (Local)</strong>: prioritize smooth local
              playback; avoids rate changes and only resyncs as a last resort,
              so it may drift vs. other devices.
            </small>
          </div>
        </section>

        <!-- Status Section -->
        <section class="card" id="status-section">
          <h2>Player Status</h2>
          <div class="status-grid">
            <div class="status-item">
              <span class="status-label">Connection</span>
              <span id="connection-status" class="status-value disconnected"
                >Disconnected</span
              >
            </div>
            <div class="status-item">
              <span class="status-label">Playback</span>
              <span id="playback-status" class="status-value">Stopped</span>
            </div>
            <div class="status-item">
              <span class="status-label">Sync State</span>
              <span id="sync-status" class="status-value">-</span>
            </div>
            <div class="status-item">
              <span class="status-label">Format</span>
              <span id="format-status" class="status-value">-</span>
            </div>
          </div>

          <h3>Sync Information</h3>
          <div class="status-grid">
            <div class="status-item">
              <span class="status-label">Clock Drift</span>
              <span id="clock-drift" class="status-value">-</span>
            </div>
            <div class="status-item">
              <span class="status-label">Sync Error</span>
              <span id="sync-error" class="status-value">-</span>
            </div>
            <div class="status-item">
              <span class="status-label">Output Latency</span>
              <span id="output-latency" class="status-value">-</span>
            </div>
            <div class="status-item">
              <span class="status-label">Resync Count</span>
              <span id="resync-count" class="status-value">-</span>
            </div>
            <div class="status-item">
              <span class="status-label">Correction Mode</span>
              <span id="correction-mode-status" class="status-value">-</span>
            </div>
            <div class="status-item">
              <span class="status-label">Correction Method</span>
              <span id="correction-method" class="status-value">-</span>
            </div>
            <div class="status-item">
              <span class="status-label">Playback Rate</span>
              <span id="playback-rate" class="status-value">-</span>
            </div>
            <div class="status-item">
              <span class="status-label">Samples Adjusted</span>
              <span id="samples-adjusted" class="status-value">-</span>
            </div>
            <div class="status-item">
              <span class="status-label">Time Sync</span>
              <span id="time-sync-synced" class="status-value">-</span>
            </div>
            <div class="status-item">
              <span class="status-label">Time Offset</span>
              <span id="time-sync-offset" class="status-value">-</span>
            </div>
            <div class="status-item">
              <span class="status-label">Time Error</span>
              <span id="time-sync-error" class="status-value">-</span>
            </div>
          </div>
        </section>
      </main>

      <footer>
        <p>
          <a href="https://github.com/sendspin/sendspin-js" target="_blank"
            >GitHub</a
          >
          |
          <a
            href="https://www.npmjs.com/package/@music-assistant/sendspin-js"
            target="_blank"
            >npm</a
          >
          | Part of the
          <a href="https://www.sendspin-audio.com" target="_blank"
            >Sendspin Protocol</a
          >
        </p>
      </footer>
    </div>

    <script type="module" src="public/app.js"></script>
  </body>
</html>
