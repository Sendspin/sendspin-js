#!/usr/bin/env node
import { readFileSync, writeFileSync } from "fs";
import { dirname, join } from "path";
import { fileURLToPath } from "url";

const __dirname = dirname(fileURLToPath(import.meta.url));
const rootDir = join(__dirname, "..");

const flacPath = join(rootDir, "assets", "almost_silent.flac");
const outputPath = join(rootDir, "src", "silent-audio.generated.ts");

const flacBuffer = readFileSync(flacPath);
const base64 = flacBuffer.toString("base64");
const dataUrl = `data:audio/flac;base64,${base64}`;

const tsContent = `// Auto-generated by scripts/bundle-silent-audio.js
// Almost-silent audio for Android MediaSession workaround
export const SILENT_AUDIO_SRC = "${dataUrl}";
`;

writeFileSync(outputPath, tsContent);
console.log(
  `Generated ${outputPath} (${Math.round(base64.length / 1024)}KB base64)`,
);
